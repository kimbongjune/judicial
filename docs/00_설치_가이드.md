# 설치 가이드

## 1. 시스템 요구사항

### 1.1 하드웨어 요구사항

| 항목 | 최소 사양 | 권장 사양 |
|------|----------|----------|
| CPU | 4코어 | 8코어 이상 |
| RAM | 8GB | 16GB 이상 |
| Storage | 20GB | 50GB 이상 (SSD 권장) |
| GPU | 불필요 | 불필요 (CPU 임베딩 사용) |

### 1.2 운영체제

- macOS 12+ (Monterey 이상)
- Ubuntu 22.04 LTS
- Windows 10/11 (WSL2 권장)

---

## 2. 필수 소프트웨어 설치

### 2.1 Anaconda / Miniconda

**macOS (Homebrew)**
```bash
brew install --cask anaconda
# 또는 Miniconda (경량 버전)
brew install --cask miniconda
```

**macOS (공식 설치파일)**
```bash
# Miniconda 다운로드 및 설치
curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh
bash Miniconda3-latest-MacOSX-arm64.sh
```

**Ubuntu**
```bash
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
```

**설치 확인**
```bash
conda --version
# conda 24.x.x
```

---

### 2.2 PostgreSQL

**macOS (Homebrew)**
```bash
brew install postgresql@15
brew services start postgresql@15
```

**Ubuntu**
```bash
sudo apt update
sudo apt install postgresql-15 postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

**데이터베이스 생성**
```bash
# PostgreSQL 접속
psql postgres

# 데이터베이스 및 사용자 생성
CREATE DATABASE judicial;
CREATE USER judicial_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE judicial TO judicial_user;
\q
```

---

### 2.3 Git

**macOS**
```bash
# Xcode Command Line Tools에 포함
xcode-select --install

# 또는 Homebrew
brew install git
```

**Ubuntu**
```bash
sudo apt install git
```

---

## 3. 프로젝트 환경 설정

### 3.1 저장소 클론

```bash
cd ~/dev
git clone <repository-url> judicial
cd judicial
```

### 3.2 Conda 환경 생성

```bash
# Python 3.10 가상환경 생성
conda create -n judicial python=3.10 -y

# 환경 활성화
conda activate judicial

# 패키지 설치
pip install -r requirements.txt

# 환경 확인
conda env list
```

### 3.3 환경변수 설정

```bash
# .env 파일 생성
cp .env.example .env

# .env 파일 편집
vi .env
```

**.env 파일 내용**
```env
# 법제처 API
LAW_API_OC=nocdu112

# 데이터베이스
DATABASE_URL=postgresql+asyncpg://judicial_user:your_password@localhost:5432/judicial

# 앱 설정
APP_ENV=development
DEBUG=true
SECRET_KEY=your-secret-key-here

# 임베딩 모델
EMBEDDING_MODEL=jhgan/ko-sroberta-multitask
FAISS_INDEX_PATH=./data/faiss
```

---

## 4. 데이터베이스 초기화

### 4.1 테이블 생성

```bash
# Conda 환경 활성화 상태에서
python scripts/init_db.py

# 기존 테이블 삭제 후 재생성 (데이터 초기화)
python scripts/init_db.py --drop

# 확인 없이 삭제 후 재생성
python scripts/init_db.py --drop --force
```

### 4.2 초기 데이터 수집 (ETL)

```bash
# 판례 데이터 수집 - 모든 데이터 수집 (시간 소요)
python scripts/run_etl.py --target prec

# 헌재결정례 수집 - 모든 데이터
python scripts/run_etl.py --target detc

# 법령해석례 수집 - 모든 데이터
python scripts/run_etl.py --target expc

# 법령 데이터 수집
python scripts/run_etl.py --target law

# 법령용어 수집
python scripts/run_etl.py --target term

# 전체 데이터 수집 (모든 타겟 - 순차 처리)
# 수집 순서: 판례 → 헌재결정례 → 법령해석례 → 법령 → 법령용어
python scripts/run_etl.py --target all

# 테스트용 소량 수집 (10페이지만)
python scripts/run_etl.py --target prec --limit 10

# 벡터화 없이 DB 저장만
python scripts/run_etl.py --target prec --no-vectorize

# 병렬 처리 개수 조절 (기본값: 5)
python scripts/run_etl.py --target prec --concurrency 10

# 페이지당 항목 수 조절 (기본값: 100)
python scripts/run_etl.py --target prec --display 50

# 옵션 조합 예시
python scripts/run_etl.py --target all --concurrency 10 --display 100 --limit 5
```

---

## 5. 임베딩 인덱스 생성

ETL 실행 시 자동으로 FAISS 인덱스가 생성됩니다.

```bash
# ETL 실행 시 자동 벡터화 (기본값)
python scripts/run_etl.py --target prec

# 벡터화 없이 DB 저장만 하려면
python scripts/run_etl.py --target prec --no-vectorize
```

**FAISS 인덱스 저장 위치:**
- `data/faiss/case_index.faiss` (판례)
- `data/faiss/constitutional_index.faiss` (헌재결정례)
- `data/faiss/interpretation_index.faiss` (법령해석례)

---

## 6. 서버 실행

### 6.1 개발 서버

```bash
# Uvicorn 개발 서버 실행
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 6.2 접속 확인

- 메인 페이지: http://localhost:8000
- API 문서: http://localhost:8000/api/docs
- ReDoc: http://localhost:8000/api/redoc

---

## 7. 설치 검증

### 7.1 Python 패키지 확인

```bash
conda activate judicial
python -c "import fastapi; print(f'FastAPI: {fastapi.__version__}')"
python -c "import torch; print(f'PyTorch: {torch.__version__}')"
python -c "import sentence_transformers; print('Sentence Transformers: OK')"
python -c "import faiss; print(f'FAISS: {faiss.__version__}')"
```

### 7.2 API 연결 테스트

```bash
# 법제처 API 테스트
curl "http://www.law.go.kr/DRF/lawSearch.do?OC=nocdu112&target=prec&type=XML&display=1"
```

### 7.3 데이터베이스 연결 테스트

```bash
python -c "
from app.database import engine
from sqlalchemy import text
with engine.connect() as conn:
    result = conn.execute(text('SELECT 1'))
    print('Database connection: OK')
"
```

---

## 8. 문제 해결

### 8.1 Conda 환경 문제

```bash
# 환경 재생성
conda env remove -n judicial
conda env create -f environment.yml
```

### 8.2 PyTorch 설치 문제 (Apple Silicon)

```bash
# Apple Silicon용 PyTorch
pip install torch torchvision torchaudio
```

### 8.3 FAISS 설치 문제

```bash
# CPU 버전 설치
pip install faiss-cpu

# 또는 conda로 설치
conda install -c conda-forge faiss-cpu
```

### 8.4 PostgreSQL 연결 문제

```bash
# 서비스 상태 확인
brew services list | grep postgresql

# 서비스 재시작
brew services restart postgresql@15
```

---

## 9. 다음 단계

1. [명령어 가이드](./00_명령어_가이드.md) - 자주 사용하는 명령어
2. [프로젝트 개요](./01_프로젝트_개요.md) - 프로젝트 구조 이해
3. [ETL 설계](./09_ETL_설계.md) - 데이터 수집 상세
