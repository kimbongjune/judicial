<!-- 법령 용어 툴팁 컴포넌트 -->
<!-- 본문 텍스트 내의 법령 용어에 마우스를 올리면 해석이 표시됨 -->

<style>
/* 법령 용어 하이라이트 스타일 */
.law-term {
    border-bottom: 1px dotted #3b82f6;
    cursor: help;
    position: relative;
}

.law-term:hover {
    background-color: #dbeafe;
}

/* 툴팁 스타일 */
.law-term-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 12px;
    background-color: #1e293b;
    color: white;
    border-radius: 6px;
    font-size: 13px;
    white-space: normal;
    max-width: 300px;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.law-term-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1e293b;
}

.law-term:hover .law-term-tooltip {
    opacity: 1;
    visibility: visible;
}

/* 사이드 패널 스타일 (오른쪽에 표시) */
.law-term-sidebar {
    position: fixed;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 320px;
    max-height: 80vh;
    overflow-y: auto;
    background-color: white;
    border-left: 1px solid #e5e7eb;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
    z-index: 40;
    padding: 20px;
    transition: transform 0.3s ease;
}

.law-term-sidebar.hidden {
    transform: translateY(-50%) translateX(100%);
}

.law-term-sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e5e7eb;
}

.law-term-sidebar-title {
    font-weight: 600;
    color: #1f2937;
}

.law-term-sidebar-close {
    color: #9ca3af;
    cursor: pointer;
}

.law-term-sidebar-close:hover {
    color: #4b5563;
}

.law-term-item {
    margin-bottom: 16px;
    padding: 12px;
    background-color: #f9fafb;
    border-radius: 8px;
}

.law-term-item-name {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 4px;
}

.law-term-item-definition {
    font-size: 14px;
    color: #4b5563;
    line-height: 1.5;
}

.law-term-item-source {
    font-size: 12px;
    color: #9ca3af;
    margin-top: 8px;
}
</style>

<script>
// 법령 용어 데이터 캐시
const lawTermsCache = new Map();

// 법령 용어 API 호출
async function fetchLawTermDefinition(term) {
    if (lawTermsCache.has(term)) {
        return lawTermsCache.get(term);
    }
    
    try {
        const response = await fetch(`/api/law-terms?term=${encodeURIComponent(term)}`);
        if (response.ok) {
            const data = await response.json();
            lawTermsCache.set(term, data);
            return data;
        }
    } catch (error) {
        console.error('법령 용어 조회 실패:', error);
    }
    
    return null;
}

// 텍스트 내 법령 용어 하이라이트
function highlightLawTerms(containerSelector, terms) {
    const container = document.querySelector(containerSelector);
    if (!container) return;
    
    let html = container.innerHTML;
    
    terms.forEach(term => {
        const regex = new RegExp(`(${term.term})`, 'g');
        html = html.replace(regex, `
            <span class="law-term" 
                  data-term="${term.term}"
                  onmouseenter="showTermTooltip(this, '${term.definition?.replace(/'/g, "\\'")}')">
                $1
                <span class="law-term-tooltip">${term.definition || '정의를 불러오는 중...'}</span>
            </span>
        `);
    });
    
    container.innerHTML = html;
}

// 툴팁 표시
function showTermTooltip(element, definition) {
    const tooltip = element.querySelector('.law-term-tooltip');
    if (tooltip && definition) {
        tooltip.textContent = definition;
    }
}

// 사이드바 토글
function toggleLawTermSidebar() {
    const sidebar = document.getElementById('lawTermSidebar');
    if (sidebar) {
        sidebar.classList.toggle('hidden');
    }
}

// 사이드바에 용어 추가
function addTermToSidebar(term, definition, source) {
    const container = document.getElementById('lawTermSidebarContent');
    if (!container) return;
    
    const existingItem = container.querySelector(`[data-term="${term}"]`);
    if (existingItem) return;
    
    const item = document.createElement('div');
    item.className = 'law-term-item';
    item.dataset.term = term;
    item.innerHTML = `
        <div class="law-term-item-name">${term}</div>
        <div class="law-term-item-definition">${definition || '정의 없음'}</div>
        ${source ? `<div class="law-term-item-source">출처: ${source}</div>` : ''}
    `;
    
    container.appendChild(item);
    
    // 사이드바 표시
    const sidebar = document.getElementById('lawTermSidebar');
    if (sidebar) {
        sidebar.classList.remove('hidden');
    }
}

// 법령 용어 클릭 시 사이드바에 표시
document.addEventListener('click', async (e) => {
    const termElement = e.target.closest('.law-term');
    if (termElement) {
        const term = termElement.dataset.term;
        const data = await fetchLawTermDefinition(term);
        if (data) {
            addTermToSidebar(term, data.definition, data.source);
        }
    }
});
</script>

<!-- 법령 용어 사이드바 -->
<div id="lawTermSidebar" class="law-term-sidebar hidden">
    <div class="law-term-sidebar-header">
        <span class="law-term-sidebar-title">법령 용어 해석</span>
        <button onclick="toggleLawTermSidebar()" class="law-term-sidebar-close">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>
    <div id="lawTermSidebarContent">
        <!-- 동적으로 용어가 추가됨 -->
    </div>
</div>
